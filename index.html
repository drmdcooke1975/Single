<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Passage Viewer1</title>
</head>
<body>
    <h1>Passage of Play</h1>

    <!-- Team 1 Tactical Choice Dropdown -->
    <label for="team1Tactic">Team 1 Tactical Choice:</label>
    <select id="team1Tactic">
        <option value="Attack">Attack</option>
        <option value="Hold" selected>Hold</option>
        <option value="Defend">Defend</option>
    </select>

    <p id="passage">Loading passage...</p>
    <p id="matchResults">Loading match results...</p>
    <p id="matchScore">Loading score...</p>
    <p id="debugLogs">Debug Logs: Awaiting response...</p>

    <button id="startGameButton">Start Game Passage</button>
    <button id="resetGameButton">Reset Game</button>

    <p id="gameStatus">Awaiting game start...</p>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbxkuyhfUll53XatIT6X4_V7NbZrh4q9BxdOafsLH2UYZnXcuhb5vaHhm7rpI0HD_IBvRA/exec";

        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("startGameButton").addEventListener("click", playPassage);
            document.getElementById("resetGameButton").addEventListener("click", resetGame);

            function playPassage() {
                const tactic = document.getElementById("team1Tactic").value;
                const url = `${scriptURL}?action=passage&tactic=${tactic}&t=${new Date().getTime()}`;
                document.getElementById("debugLogs").innerText = "[START GAME] Fetching passage...";

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        const passageData = data.passageData || {};
                        let logOutput = "[LOGS]\n";
                        logOutput += `Initial Passage Count: ${passageData.passagesPlayed - 1}\n`;
                        logOutput += `Updated Passage Count: ${passageData.passagesPlayed}\n`;
                        logOutput += `Status: ${passageData.status}\n`;
                        logOutput += `Team 1 Tactic: ${passageData.team1Tactic}\n`;
                        logOutput += `Team 2 Tactic: ${passageData.team2Tactic}\n`;
                        logOutput += `Possession Winner: ${passageData.possessionWinner}\n`;
                        logOutput += `Team 1 Score: ${passageData.team1Score}\n`;
                        logOutput += `Team 2 Score: ${passageData.team2Score}\n\n`;
                        if (Array.isArray(passageData.debugLogs)) {
                            logOutput += passageData.debugLogs.join("\n");
                        }

                        document.getElementById("gameStatus").innerText = "Game Started!";
                        document.getElementById("passage").innerText = passageData.passageOfPlay || "No passage returned.";
                        document.getElementById("matchScore").innerText = passageData.matchScore || "Score unavailable.";
                        document.getElementById("debugLogs").innerText = logOutput;
                    })
                    .catch(error => {
                        document.getElementById("debugLogs").innerText = `Error: ${error.message}`;
                    });
            }

            function resetGame() {
                const url = `${scriptURL}?action=resetGameData&t=${new Date().getTime()}`;
                document.getElementById("debugLogs").innerText = "[RESET GAME] Resetting game...";

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("gameStatus").innerText = "Game Reset.";
                        document.getElementById("passage").innerText = "";
                        document.getElementById("matchScore").innerText = "";
                        document.getElementById("debugLogs").innerText = Array.isArray(data.debugLogs)
                            ? data.debugLogs.join("\n")
                            : data.debugLogs || "Reset complete.";
                    })
                    .catch(error => {
                        document.getElementById("debugLogs").innerText = `Error: ${error.message}`;
                    });
            }
        });
    </script>
</body>
</html>
