<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Passage Viewer 1</title>
</head>
<body>
    <h1>Passage of Play</h1>

    <p id="passage">Loading passage...</p>
    <p id="matchResults">Loading match results...</p>
    <p id="matchScore">Loading score...</p>
    <p id="debugLogs">Debug Logs: Awaiting response...</p>

    <button id="startGameButton">Start Game</button>
    <button id="resetGameButton">Reset Game</button>

    <p id="gameStatus">Awaiting game start...</p>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbz-6oTeGIeqEmIJhbP0eme-sJxy_0lPCptZPETnSX252MZ_UULT1xS2DG73pfYr5HycvA/exec";

        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("startGameButton").addEventListener("click", startGame);
            document.getElementById("resetGameButton").addEventListener("click", resetGame);

            function startGame() {
                const url = `${scriptURL}?action=passage&t=${new Date().getTime()}`;
                document.getElementById("debugLogs").innerText = "[START GAME] Fetching passage...";

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        const passageData = data.passageData || {};
                        document.getElementById("gameStatus").innerText = "Game Started!";
                        document.getElementById("passage").innerText = passageData.passageOfPlay || "No passage returned.";
                        document.getElementById("matchScore").innerText = passageData.matchScore || "Score unavailable.";
                        document.getElementById("debugLogs").innerText = Array.isArray(passageData.debugLogs)
                            ? passageData.debugLogs.join("\n")
                            : passageData.debugLogs || "No logs.";
                    })
                    .catch(error => {
                        document.getElementById("debugLogs").innerText = `Error: ${error.message}`;
                    });
            }

            function resetGame() {
                const url = `${scriptURL}?action=resetGameData&t=${new Date().getTime()}`;
                document.getElementById("debugLogs").innerText = "[RESET GAME] Resetting game...";

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("gameStatus").innerText = "Game Reset.";
                        document.getElementById("passage").innerText = "";
                        document.getElementById("matchScore").innerText = "";
                        document.getElementById("debugLogs").innerText = Array.isArray(data.debugLogs)
                            ? data.debugLogs.join("\n")
                            : data.debugLogs || "Reset complete.";
                    })
                    .catch(error => {
                        document.getElementById("debugLogs").innerText = `Error: ${error.message}`;
                    });
            }
        });
    </script>
</body>
</html>
