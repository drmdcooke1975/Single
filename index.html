<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Passage Viewer  2  </title>
</head>
<body>
    <h1>Passage of Play 1</h1>
    
    <p id="passage">Loading passage...</p>
    <p id="matchResults">Loading match results...</p>
    <p id="matchScore">Loading score...</p>

    <button id="startGameButton">Start Game</button>
    <p id="gameStatus">Awaiting game start...</p>

    <script>
        function updateZ2() {
            fetch("https://script.google.com/macros/s/AKfycbzfsqkJhrwPv9J9DeJa5nlxtCGXOPOnAJ0gb4x9esmoVM-nUsLvAx4YzLY8T1Ypou3woA/exec", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ action: "startGame" }) // Sends a request to update Z2
            })
            .then(response => response.json())
            .then(data => {
                console.log("Z2 Update Response:", data);
                document.getElementById("gameStatus").innerText = "Game Started! Z2 set to RUN.";

                // ✅ After updating Z2, fetch match data
                fetchMatchData();
            })
            .catch(error => console.error("Error updating Z2:", error));
        }

        function fetchMatchData() {
            fetch("https://script.google.com/macros/s/AKfycbzfsqkJhrwPv9J9DeJa5nlxtCGXOPOnAJ0gb4x9esmoVM-nUsLvAx4YzLY8T1Ypou3woA/exec")
            .then(response => response.json())
            .then(data => {
                console.log("Fetched Data:", data);

                if (data.team1Score !== undefined && data.team2Score !== undefined) {
                    document.getElementById("matchScore").innerText = `Score: ${data.team1Score} - ${data.team2Score}`;
                    document.getElementById("gameStatus").innerText = `Team 1: ${data.team1Score} | Team 2: ${data.team2Score}`;
                } else {
                    document.getElementById("gameStatus").innerText = "Error: Invalid match data";
                }

                document.getElementById("matchResults").innerText = `Possession: ${data.possessionWinner || "Data not available"}`;
                document.getElementById("passage").innerText = `${data.passageOfPlay.text || "Awaiting passage update..."} - ${data.passageOfPlay.eventText || "No event recorded"}`;
            })
            .catch(error => {
                console.error("API Error:", error);
                document.getElementById("matchResults").innerText = "Error fetching match results.";
                document.getElementById("matchScore").innerText = "Error fetching score.";
                document.getElementById("passage").innerText = "Error fetching passage.";
                document.getElementById("gameStatus").innerText = "Error loading game data.";
            });
        }

        // ✅ Load match data on page load
        document.addEventListener("DOMContentLoaded", fetchMatchData);

        // ✅ Start Game Button: First update Z2, then fetch match data
        document.getElementById("startGameButton").addEventListener("click", updateZ2);
    </script>
</body>
</html>
