<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Passage Viewer V10:51 12 July 2025</title>
</head>
<body>
    <h1>Passage of Play</h1>

    <p id="passage">Loading passage...</p>
    <p id="matchResults">Loading match results...</p>
    <p id="matchScore">Loading score...</p>
    <p id="debugLogs">Debug Logs: Awaiting response...</p>

    <button id="startGameButton">Start Game</button>
    <button id="resetGameButton">Reset Game</button>

    <p id="gameStatus">Awaiting game start...</p>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbxOj4hCdAsQg8KBWOd3rVMlRdqqU_wguJhCtdo5U7-gBT0iNYPVyN8KuIxn_aK--uqyrQ/exec";

        document.addEventListener("DOMContentLoaded", function () {
            function fetchMatchData() {
                const url = `${scriptURL}?action=passage&t=${new Date().getTime()}`;
                console.log("[DEBUG] Fetching:", url);
                document.getElementById("debugLogs").innerText = "[DEBUG] Sending GET request to start passage simulation...";

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        const passage = data.passageData?.passageOfPlay || {};
                        document.getElementById("debugLogs").innerText = `[DEBUG] Response:\n${JSON.stringify(data.passageData?.debugLogs || ["No logs"], null, 2)}`;
                        document.getElementById("matchScore").innerText = `Score: ${data.passageData?.team1Score} - ${data.passageData?.team2Score}`;
                        document.getElementById("gameStatus").innerText = `Team 1: ${data.passageData?.team1Score} | Team 2: ${data.passageData?.team2Score}`;
                        document.getElementById("matchResults").innerText = `Possession: ${data.passageData?.possessionWinner || "Not determined"}`;
                        document.getElementById("passage").innerText = `${passage.text || "No passage"} - ${passage.eventText || "No event"}`;
                    })
                    .catch(error => {
                        console.error("[ERROR] Failed to fetch match data:", error);
                        document.getElementById("debugLogs").innerText = `[ERROR] Fetch failed:\n${error}`;
                    });
            }

            function resetGame() {
                const resetURL = `${scriptURL}?action=resetGameData&t=${new Date().getTime()}`;
                console.log("[DEBUG] Reset Fetch:", resetURL);
                document.getElementById("debugLogs").innerText = "[DEBUG] Sending reset request...";

                fetch(resetURL)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("debugLogs").innerText = `[DEBUG] Reset Response:\n${JSON.stringify(data.debugLogs || ["No logs"], null, 2)}`;
                        document.getElementById("gameStatus").innerText = data.status || "Game reset";
                        document.getElementById("passage").innerText = "Awaiting passage update...";
                        document.getElementById("matchResults").innerText = "Awaiting match results...";
                        document.getElementById("matchScore").innerText = "Score: 0 - 0";
                    })
                    .catch(error => {
                        console.error("[ERROR] Reset failed:", error);
                        document.getElementById("debugLogs").innerText = `[ERROR] Reset failed:\n${error}`;
                    });
            }

            document.getElementById("startGameButton").addEventListener("click", fetchMatchData);
            document.getElementById("resetGameButton").addEventListener("click", resetGame);
        });
    </script>
</body>
</html>
